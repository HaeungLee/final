<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .logout-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 3rem;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            text-align: center;
            max-width: 500px;
            margin: 0 auto;
        }
        
        .logout-icon {
            font-size: 4rem;
            color: #28a745;
            margin-bottom: 1.5rem;
        }
        
        .provider-info {
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
            border-radius: 10px;
            padding: 1rem;
            margin: 1.5rem 0;
            border-left: 4px solid #007bff;
        }
        
        .btn-home {
            background: linear-gradient(45deg, #007bff, #0056b3);
            border: none;
            color: white;
            padding: 12px 30px;
            border-radius: 25px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn-home:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 123, 255, 0.3);
            color: white;
        }
        
        .countdown {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logout-container">
            <div class="logout-icon">
                âœ…
            </div>
              <h2 class="mb-3 text-success fw-bold">ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ!</h2>
            
            <div class="alert alert-success" style="border-radius: 15px; border: none; margin-bottom: 1.5rem;">
                <strong>âœ… ì •ìƒì ìœ¼ë¡œ ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤</strong><br>
                <small>ì†Œì…œ ê³„ì •ì—ì„œë„ ì•ˆì „í•˜ê²Œ ë¡œê·¸ì•„ì›ƒë˜ì–´ ìë™ ë¡œê·¸ì¸ì´ ë°©ì§€ë©ë‹ˆë‹¤.</small>
            </div>
            
            <div style="background: linear-gradient(45deg, #e8f5e8, #f0f8f0); border-radius: 10px; padding: 1rem; margin: 1.5rem 0; border-left: 4px solid #28a745;">
                <div class="d-flex align-items-center justify-content-center">
                    <span style="font-size: 1.2rem; margin-right: 0.5rem;">ğŸ”’</span>
                    <span><strong>ë³´ì•ˆ ì™„ë£Œ:</strong> ëª¨ë“  ì„¸ì…˜ì´ ì•ˆì „í•˜ê²Œ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤</span>
                </div>
            </div>
              <!-- ì†Œì…œ ì œê³µì ì •ë³´ í‘œì‹œ -->
            <div th:if="${provider}" class="provider-info">
                <strong>
                    <span th:if="${provider == 'google'}">ğŸ” Google</span>
                    <span th:if="${provider == 'kakao'}">ğŸŸ¡ Kakao</span>
                    <span th:if="${provider == 'naver'}">ğŸŸ¢ Naver</span>
                    <span th:if="${provider != 'google' && provider != 'kakao' && provider != 'naver'}" th:text="${provider}"></span>
                </strong>
                ê³„ì •ì—ì„œë„ ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.
                  <!-- ë„¤ì´ë²„ íŠ¹í™” ë©”ì‹œì§€ -->
                <div th:if="${provider == 'naver'}" style="margin-top: 10px; padding: 10px; background: #e8f5e8; border-radius: 5px;">
                    <small>
                        <strong>âœ… ë„¤ì´ë²„ ì™„ì „ ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ</strong><br>
                        â€¢ ğŸ”‘ Token Revocation: access_token/refresh_token íê¸°<br>
                        â€¢ ğŸ—‘ï¸ ë„¤ì´ë²„ ì—°ê²°ëœ ì„œë¹„ìŠ¤ì—ì„œ ì•± ì œê±°<br>
                        â€¢ ğŸ§¹ ë¸Œë¼ìš°ì € ì„¸ì…˜ ì™„ì „ ì‚­ì œ<br>
                        â€¢ ğŸ”’ ìë™ ë¡œê·¸ì¸ ë°©ì§€ ì²˜ë¦¬ ì™„ë£Œ<br>
                        â€¢ ğŸ“± ëª¨ë“  ë„¤ì´ë²„ ì„œë¹„ìŠ¤ì—ì„œ ë¡œê·¸ì•„ì›ƒ
                    </small>
                </div>
            </div>
            
            <div class="d-grid gap-2">
                <a href="/" class="btn-home">
                    ğŸ  ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°
                </a>
            </div>
            
            <div class="countdown">
                <span id="countdown">5</span>ì´ˆ í›„ ìë™ìœ¼ë¡œ ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.
            </div>
            
            <div class="mt-4">
                <small class="text-muted">
                    ğŸ”’ ëª¨ë“  ì„¸ì…˜ì´ ì•ˆì „í•˜ê²Œ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.
                </small>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>    <script>
        // URL íŒŒë¼ë¯¸í„°ì—ì„œ provider ì •ë³´ ì¶”ì¶œ
        const urlParams = new URLSearchParams(window.location.search);
        const provider = urlParams.get('provider') || /*[[${provider}]]*/ '';
        
        // ê°•í™”ëœ ë¸Œë¼ìš°ì € ì €ì¥ì†Œ ì •ë¦¬
        function clearBrowserStorage() {
            try {
                console.log('ğŸ§¹ ìµœì¢… ë¸Œë¼ìš°ì € ì €ì¥ì†Œ ì •ë¦¬ ì‹œì‘');
                
                // 1. localStorage ì™„ì „ ì •ë¦¬
                if (window.localStorage) {
                    const localKeys = Object.keys(localStorage);
                    console.log('localStorage ì „ì²´ í•­ëª©:', localKeys);
                    
                    // OAuth2 ë° ì†Œì…œ ë¡œê·¸ì¸ ê´€ë ¨ ì €ì¥ì†Œ í‚¤ ì •ë¦¬
                    const keysToRemove = [
                        'accessToken', 'refreshToken', 'userInfo', 'authToken',
                        'loginProvider', 'naverAccessToken', 'naverUserInfo',
                        'googleAccessToken', 'kakaoAccessToken', 'jwt_token',
                        'oauth2_state', 'oauth2_code_verifier', 'oauth2_redirect_uri',
                        'social_login_provider', 'social_user_info',
                        // ë„¤ì´ë²„ íŠ¹í™” í‚¤ë“¤
                        'naver_login_state', 'naver_callback_url', 'nid_aut', 'nid_ses',
                        // êµ¬ê¸€ íŠ¹í™” í‚¤ë“¤
                        'google_auth_state', 'google_oauth_token',
                        // ì¹´ì¹´ì˜¤ íŠ¹í™” í‚¤ë“¤
                        'kakao_auth_token', 'kakao_user_data'
                    ];
                    
                    keysToRemove.forEach(key => {
                        localStorage.removeItem(key);
                        console.log('localStorage ì‚­ì œ:', key);
                    });
                    
                    // íŒ¨í„´ ë§¤ì¹­ìœ¼ë¡œ ì¶”ê°€ ì •ë¦¬
                    localKeys.forEach(key => {
                        const lowerKey = key.toLowerCase();
                        if (lowerKey.includes('oauth') || lowerKey.includes('token') || 
                            lowerKey.includes('auth') || lowerKey.includes('naver') ||
                            lowerKey.includes('google') || lowerKey.includes('kakao')) {
                            localStorage.removeItem(key);
                            console.log('íŒ¨í„´ ë§¤ì¹­ localStorage ì‚­ì œ:', key);
                        }
                    });
                    
                    // í•„ìš”ì‹œ ì „ì²´ localStorage ì •ë¦¬ (ì£¼ì˜: ë‹¤ë¥¸ ë°ì´í„°ë„ ì‚­ì œë¨)
                    // localStorage.clear();
                }
                
                // 2. sessionStorage ì™„ì „ ì •ë¦¬
                if (window.sessionStorage) {
                    const sessionKeys = Object.keys(sessionStorage);
                    console.log('sessionStorage ì „ì²´ í•­ëª©:', sessionKeys);
                    
                    // sessionStorageëŠ” ì „ì²´ ì •ë¦¬ (ì„¸ì…˜ ì¢…ë£Œì‹œ ì–´ì°¨í”¼ ì‚­ì œë¨)
                    sessionStorage.clear();
                    console.log('âœ… sessionStorage ì „ì²´ ì •ë¦¬ ì™„ë£Œ');
                }
                
                // 3. ì¿ í‚¤ ì¬í™•ì¸ ë° ì •ë¦¬ (JavaScriptë¡œ ì ‘ê·¼ ê°€ëŠ¥í•œ ì¿ í‚¤ë“¤)
                clearRemainingCookies();
                
                console.log('âœ… ìµœì¢… ë¸Œë¼ìš°ì € ì €ì¥ì†Œ ì •ë¦¬ ì™„ë£Œ');
                
            } catch (e) {
                console.warn('âš ï¸ ì €ì¥ì†Œ ì •ë¦¬ ì¤‘ ì˜¤ë¥˜:', e);
            }
        }
        
        // ë‚¨ì€ ì¿ í‚¤ë“¤ ì •ë¦¬
        function clearRemainingCookies() {
            try {
                console.log('ğŸª ë‚¨ì€ ì¿ í‚¤ ì •ë¦¬ ì‹œì‘');
                
                // í˜„ì¬ ë„ë©”ì¸ì˜ ëª¨ë“  ì¿ í‚¤ í™•ì¸
                const cookies = document.cookie.split(';');
                console.log('í˜„ì¬ ì¿ í‚¤ë“¤:', cookies);
                
                // ê° ì¿ í‚¤ ì‚­ì œ ì‹œë„
                cookies.forEach(cookie => {
                    const eqPos = cookie.indexOf('=');
                    const name = eqPos > -1 ? cookie.substr(0, eqPos).trim() : cookie.trim();
                    
                    if (name) {
                        // ë‹¤ì–‘í•œ ê²½ë¡œì™€ ë„ë©”ì¸ì—ì„œ ì¿ í‚¤ ì‚­ì œ ì‹œë„
                        const paths = ['/', '/user', '/api', ''];
                        const domains = ['', `.${window.location.hostname}`, window.location.hostname];
                        
                        paths.forEach(path => {
                            domains.forEach(domain => {
                                let cookieString = `${name}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=${path};`;
                                if (domain) {
                                    cookieString += ` domain=${domain};`;
                                }
                                document.cookie = cookieString;
                            });
                        });
                        
                        console.log('ì¿ í‚¤ ì‚­ì œ ì‹œë„:', name);
                    }
                });
                
                console.log('âœ… ë‚¨ì€ ì¿ í‚¤ ì •ë¦¬ ì™„ë£Œ');
                
            } catch (e) {
                console.warn('âš ï¸ ì¿ í‚¤ ì •ë¦¬ ì¤‘ ì˜¤ë¥˜:', e);
            }
        }
        
        // ë„¤ì´ë²„ íŠ¹í™” ìµœì¢… ì •ë¦¬
        function naverFinalCleanup() {
            if (provider === 'naver') {
                console.log('ğŸŸ¢ ë„¤ì´ë²„ ìµœì¢… ì •ë¦¬ ì‹œì‘');
                
                try {
                    // ë„¤ì´ë²„ íŠ¹í™” ì¿ í‚¤ë“¤ ê°•ì œ ì‚­ì œ
                    const naverCookies = ['NID_AUT', 'NID_SES', 'NID_JKL', 'NAVER_OPEN_RCVR', 'npic'];
                    naverCookies.forEach(cookieName => {
                        // ì—¬ëŸ¬ ë„ë©”ì¸ì—ì„œ ì‚­ì œ ì‹œë„
                        const domains = ['', '.naver.com', window.location.hostname];
                        domains.forEach(domain => {
                            let cookieString = `${cookieName}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`;
                            if (domain) {
                                cookieString += ` domain=${domain};`;
                            }
                            document.cookie = cookieString;
                        });
                        console.log('ë„¤ì´ë²„ ì¿ í‚¤ ê°•ì œ ì‚­ì œ:', cookieName);
                    });
                    
                    console.log('âœ… ë„¤ì´ë²„ ìµœì¢… ì •ë¦¬ ì™„ë£Œ');
                    
                } catch (e) {
                    console.warn('âš ï¸ ë„¤ì´ë²„ ìµœì¢… ì •ë¦¬ ì¤‘ ì˜¤ë¥˜:', e);
                }
            }
        }
        
        // ì´ˆê¸° ì •ë¦¬ ì‹¤í–‰
        clearBrowserStorage();
        naverFinalCleanup();
        
        // ì¹´ìš´íŠ¸ë‹¤ìš´ ë° ìë™ ë¦¬ë””ë ‰ì…˜
        let countdown = 5;
        const countdownElement = document.getElementById('countdown');
        
        const timer = setInterval(() => {
            countdown--;
            if (countdownElement) {
                countdownElement.textContent = countdown;
            }
            
            if (countdown <= 0) {
                clearInterval(timer);
                // ìµœì¢… ì •ë¦¬ í•œë²ˆ ë” ì‹¤í–‰ í›„ ì´ë™
                clearBrowserStorage();
                naverFinalCleanup();
                
                setTimeout(() => {
                    window.location.href = '/';
                }, 500);
            }
        }, 1000);
        
        // ì¦‰ì‹œ ë©”ì¸ìœ¼ë¡œ ì´ë™í•˜ëŠ” ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        const homeButton = document.querySelector('.btn-home');
        if (homeButton) {
            homeButton.addEventListener('click', (e) => {
                clearInterval(timer);
                // ìµœì¢… ì •ë¦¬ ì‹¤í–‰
                clearBrowserStorage();
                naverFinalCleanup();
            });
        }
        
        // ë¡œê·¸ ì¶œë ¥
        if (provider) {
            console.log(`${provider.toUpperCase()} ì†Œì…œ ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ`);
        }
        console.log('ê°•í™”ëœ ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ í˜ì´ì§€ ë¡œë“œë¨');
        
        // í˜ì´ì§€ ì–¸ë¡œë“œì‹œ ìµœì¢… ì •ë¦¬
        window.addEventListener('beforeunload', () => {
            clearBrowserStorage();
            naverFinalCleanup();
        });
    </script>
</body>
</html>
